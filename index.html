<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Globasa-Jaribas</title>
	<link rel="stylesheet" href="https://unpkg.com/simpledotcss@2.3.2/simple.min.css" />
	<script src="dict.js" defer="defer"></script>
</head>

<body>
	<main>
		<h1>Globasa-Jaribas</h1>
		<div id="d-start">
			<input type="button" value="Globasa - English" id="b-glb-eng" />
			<input type="button" value="English - Globasa" id="b-eng-glb" />
			<br />
			<input type="button" value="Globasa - Spanish" id="b-glb-spa" />
			<input type="button" value="Spanish - Globasa" id="b-spa-glb" />
			<br />
			<input type="button" value="Globasa - Bulgarian" id="b-glb-bul" />
			<input type="button" value="Bulgarian - Globasa" id="b-bul-glb" />
		</div>
		<div id="d-input" class="d-none">
			<textarea id="i-input" rows="10"></textarea>
		</div>
		<div id="d-output" class="d-none">
			<textarea id="i-output" rows="10" disabled="disabled"></textarea>
		</div>
		<div id="d-select" class="d-none"></div>
	</main>
	<style>
		.d-none {
			display: none;
		}
	</style>
	<script>
		const elInput = document.getElementById("i-input")
		const elSelect = document.getElementById("d-select")
		const elOutput = document.getElementById("i-output")
		const updateSelect = () => {
			elOutput.value = Array.prototype.map.call(elSelect.children, (e) => e.value).join("")
		}
		const segmenter = new Intl.Segmenter([], { granularity: "word" });
		const tr = (fLang, tLang) => {
			return (ev) => {
				const input = ev.target.value
				elSelect.innerHTML = ""
				const segments = segmenter.segment(input);
				for (const segment of segments) {
					const word = segment.segment
					let found
					if (!segment.isWordLike) {
						found = [word]
					} else if (dict[fLang][tLang].hasOwnProperty(word)) {
						found = dict[fLang][tLang][word]
					} else if (dict[fLang][tLang].hasOwnProperty(word.toLowerCase())) {
						found = dict[fLang][tLang][word.toLowerCase()]
					} else {
						found = ["[" + word + "]"]
					}
					if (found.length > 0 && found[0].startsWith("<em>") && found[0].endsWith("</em>")) {
						found.unshift("[" + word + "]")
					}
					const newSelect = document.createElement("select")
					if (!segment.isWordLike) {
						newSelect.classList.add("d-none")
						const newOption = document.createElement("option")
						newOption.value = word
						newSelect.appendChild(newOption)
					} else {
						found.forEach(word => {
							const newOption = document.createElement("option")
							let optionValue = word
							if (optionValue.indexOf("(") > -1 && optionValue.indexOf(")") > -1) {
								optionValue = optionValue.replace(/\s*\(.*?\)\s*/g, "")
							}
							if (optionValue.indexOf(": ") > -1) {
								optionValue = optionValue.substring(optionValue.indexOf(": ") + 2)
							}
							newOption.value = optionValue
							newOption.textContent = word
							newSelect.appendChild(newOption)
						})
						newSelect.addEventListener("change", updateSelect)
					}
					if (found.length < 2) {
						newSelect.setAttribute("disabled", "disabled")
					}
					elSelect.appendChild(newSelect)
				}
				updateSelect()
			}
		}
		const oc = (s, fLang, tLang) => {
			document.getElementById(s).addEventListener("click", (ev) => {
				document.getElementById("d-start").classList.add("d-none")
				document.getElementById("d-input").classList.remove("d-none")
				document.getElementById("d-select").classList.remove("d-none")
				document.getElementById("d-output").classList.remove("d-none")
				elInput.addEventListener("input", tr(fLang, tLang))
				elInput.focus()
			})
		}
		oc("b-glb-eng", "glb", "eng")
		oc("b-eng-glb", "eng", "glb")
		oc("b-glb-bul", "glb", "bul")
		oc("b-bul-glb", "bul", "glb")
		oc("b-glb-spa", "glb", "spa")
		oc("b-spa-glb", "spa", "glb")
	</script>
</body>

</html>
